#!/bin/ksh

# Carl Schelin
# Update the nessus key pair
#

BASENAME=`basename $0`
DIRNAME=`dirname $0`

if [[ ! -f ${DIRNAME}/../.config ]]
then
  echo "Unable to locate ${DIRNAME}/../.config. Exiting."
  exit 1
fi

# Source the configuration file
. ${DIRNAME}/../.config


NESSUS=`grep nessus /etc/passwd | cut -f6 -d:`

if [[ -d ${NESSUS} ]]
then
  if [[ ! -d ${NESSUS}/.ssh ]]
  then
    mkdir ${NESSUS}/.ssh
    chown nessus ${NESSUS}/.ssh
    chmod 700 ${NESSUS}/.ssh
  fi

  if [[ -f ${SCRIPTS}/etc/nessus.id_rsa.pub ]]
  then
    cp ${SCRIPTS}/etc/nessus.id_rsa.pub ${NESSUS}/.ssh/authorized_keys
  fi
fi

