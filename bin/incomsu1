#!/bin/ksh

# Carl Schelin
# copy monitoring configuration files for nagios into the nagios directory and restart nagios

TMPDIR=/var/tmp
NAGIOS=/usr/local/nagios
NAGOBJ=$NAGIOS/etc/objects
RESTART=no

for i in sqa lab prod
do
  if [[ -f $TMPDIR/monitor.$i.cfg ]]
  then
    if [[ ! -f $NAGOBJ/monitor.$i.cfg ]]
    then
      touch $NAGOBJ/monitor.$i.cfg
    fi

    diff $TMPDIR/monitor.$i.cfg $NAGOBJ/monitor.$i.cfg > $TMPDIR/monitor.$i.diff

    if [[ -s $TMPDIR/monitor.$i.diff ]]
    then
      cp $TMPDIR/monitor.$i.cfg $NAGOBJ/monitor.$i.cfg
      RESTART=yes
    fi
  fi
done


if [[ $RESTART = 'yes' ]]
then
  service nagios stop
  sleep 5
  service nagios start
fi

