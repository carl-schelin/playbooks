#!/bin/ksh

# Carl Schelin
# Generate a list of packages for import into the inventory

OS=`uname`
INTRADO='/opt/intrado'
ID=`id | cut -f1 -d\( | cut -f2 -d=`
OUTPUT=$INTRADO/etc/chkpackages.output

if [[ ! $ID = 0 ]]
then
  echo "You must be root to run this script"
  exit 1
fi

if [[ -f $OUTPUT ]]
then
  rm $OUTPUT
fi

# create a blank file to stop the complaining of the morning report
touch $OUTPUT

if [[ $OS = "Linux" ]]
then
  if [[ -f /etc/redhat-release ]]
  then
    /bin/rpm -qa | sort > $OUTPUT 2>&1
  fi
  if [[ -f /etc/centos-release ]]
  then
    /bin/rpm -qa | sort > $OUTPUT 2>&1
  fi
  if [[ -f /etc/debian_version ]]
  then
    /usr/bin/dpkg-query -l | grep "^ii " | awk '{print $2"-"$3}' > $OUTPUT 2>&1
  fi
fi

if [[ $OS = "SunOS" ]]
then
  /usr/bin/pkginfo -l > $OUTPUT 2>&1
fi

if [[ $OS = "HP-UX" ]]
then
  /usr/sbin/swlist | grep "^ " | awk '{print $1"-"$2}' > $OUTPUT 2>&1
fi

if [[ $OS = "OSF1" ]]
then
  /usr/sbin/swlist > $OUTPUT 2>&1
fi

exit 0

