#!/bin/ksh

# Carl Schelin
# Remove the netbackup java package and restart the vxpbx_exchanged service
# the package isn't needed for netbackup and adds vulnerabilities

ADMIN=/opt/intrado

if [[ -f /etc/redhat-release ]]
then

  JAVA=`rpm -qa | grep -i VRTSnbjava`

  if [[ ! -z $JAVA ]]
  then
    yum erase -y ${JAVA}

    VERIFY=`rpm -qa | grep -i VRTSnbjava`
    if [[ -z $VERIFY ]]
    then
      echo "${JAVA} has been uninstalled to address security vulnerabilities related to this version." | mailx -s `hostname | cut -f1 -d.` changelog@incojs01.scc911.com
    fi

    service vxpbx_exchanged status > /dev/null
    if [[ $? = 0 ]]
    then
      service vxpbx_exchanged restart
    fi
  fi
fi

